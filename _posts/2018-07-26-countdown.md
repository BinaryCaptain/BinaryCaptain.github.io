---
layout: post
keywords: js 倒计时
description: js实现活动精确倒计时
title: "倒计时"
tags: js 倒计时
date: 2018-07-26
categories: js
cover: 'https://binarycaptain.github.io/assets/img/countdown.png'
tags: js
subtitle: 'js倒计时'
---

## 坑点

前端页面倒计时功能在很多场景中会用到，如运营活动开始倒计时和活动结束倒计时，又如购物网站的秒杀倒计时，抢购倒计时，最近的话费代付项目中，也涉及倒计时功能，但在开发过程中遇到一些麻烦和坑点，下面和大家分享一下最后是如何解决的。

在最近的倒计时活动中，就有产品吐槽两个手机在不同时间点打开同一个活动显示的开抢倒计时不一样，误差大的甚至相差几分钟，导致某些用户在活动显示还未开始红包就已被抢完了。为什么误差会这么大呢？

对于这个问题，前台开发同学一般会猜测是这个原因：倒计时读取了客户端时间造成的，因为客户端时间和服务端时间有误差，应该读取服务器时间。

是的，倒计时不应该读取客户端时间，客户端时间用户可以随时调整，会造成不一致，应读取服务器返回时间。但实践证明，做了这一步还未够，页面运行时间长了，新开的页面和原打开页面还是存在误差。

京东团购也存在这个问题：

![](https://binarycaptain.github.io/assets/img/countdown.png)

造成误差的原因主要有几种可能：

1. 没有考虑js冻结运行耗费时间；（特别是移动端容易出现，下滑页面时倒计时不动了）

2. 没有考虑页面渲染和函数运行累积时间；（京东的误差貌似属于这种）

3. 其他代码逻辑问题（这种情况就复杂了，这里不讨论）；











