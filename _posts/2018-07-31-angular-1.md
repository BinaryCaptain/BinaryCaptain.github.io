---
layout: post
keywords: angular 依赖注入
description: angular依赖注入研究
title: "angular"
tags: angular 
date: 2018-07-31
categories: js
cover: 'https://binarycaptain.github.io/assets/img/angular.png'
tags: js
subtitle: 'angular依赖注入'
---

## angular依赖注入

什么是依赖注入呢，我的理解，简单点就是说我的东西我自己并不想来拿着，我想要我依赖的那个人来帮我拿着，当我需要的时候，他给我就行了。当然这只是简单的理解，还是用代码解释比较清楚一些。

这里有一个function，很简单。

```javascript

var a = function(name) {
	console.log(name);
}

```

我们调用ta:

```javascript

a('abc')；//abc

```

那么，就像我上面说的，我能不能自己不传参数呢，例如：

a();//undefined

如何才能实现让别人帮我们注入这个参数呢：

```javascript

var inject = function(name,callback){
  return function(){
     callback(name);
  }
}

```
像这样，我们在定义参数的时候这样传：

```javascript

a = inject('abc',a)

```
我们再调用a方法：

```javascript

a();//abc

```
这其实就是最简单的依赖注入了，当然这么简单是不行的，其实这是很无意义的，下面我们来看一下高深的angularjs：

```javascript

var MyController = function($scope){
        $scope.test = 1;
}

```

上面这段代码定义了angularjs的controller里面用到了scope，这样还看不出问题，在看下面：

```javascript
var MyController = function($scope,$http){
        $scope.test = 1;
        $http.get('');
}
```

上面这段代码在原来的基础上增加了http,那么问题就来了，angular在调用controller的时候怎么知道我需要scope还是http还是两个都需要呢，这就牵着到了angular里的依赖注入，那么我们来模拟一下。

假设没有angular的情况下，我们：

```javascript
var MyController = function($scope,$http){
        $scope.test = 1;
        $http.get('');
}
MyController();//undefined

```
肯定会报错的，然后我们来修改下我们的inject：

```
var inject = {
            dependencies: {},
            register: function(key, value) {
                this.dependencies[key] = value;
            },
            resolve: function(deps, func, scope) {
                var arr = [];
                for (var i = 0 ; i < deps.length ; i++) {
                    if (this.dependencies.hasOwnProperty(deps[i])) {
                       arr.push(this.dependencies[deps[i]])
                    }
                }
                console.log(arr);
                return function(){
                    func.apply(scope || {}, arr);
                }
 
            }
        }
```

这里解释一下，我们用了dependencies来存储所有的依赖，register来实现注册依赖，resolve方法来实现注入。

然后我们模仿angular来预先注册几个模块：

```javascript

inject.register('$http', {'get':function(){console.log('get')}});
inject.register('$scope', {'test':''});
inject.register('$location', {'hash':function(){console.log('hash')}});

```









